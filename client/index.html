<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8" />
    <script src="/socket.io/socket.io.js"></script>


</head>

<body>
    <h1>Gaussian Splat Generator</h1>
    <span>Upload a video to generate a Gaussian Splat using Nerfstudio on the <a href="http://itp-ml.itp.tsoa.nyu.edu">ITP ML Computer</a></span>
    <br /><br />
    <strong>NOTE: this process is quite slow... up to 3 hours or more... </strong>
    <br /><br />
    <hr />

    <form id="uploadForm" enctype="multipart/form-data">
        <input type="file" id="fileInput" name="files" multiple>
        <button type="submit">Upload</button>
    </form>
    <hr />
    <h2>Status:</h2>
    <div id="status" style="white-space: pre-wrap;"></div>


    <script>
        let socket = io();

        let subscriptions = JSON.parse(localStorage.getItem('subscriptions')) || [];
        subscriptions.forEach(filePath => {
            socket.emit('subscribe', { filePath: filePath });
        });

        socket.on('statusUpdate', function (data) {
            console.log('got status update:', data);
            const statusMessage = document.getElementById('status');
            statusMessage.textContent = data;

        });
        document.getElementById('uploadForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const file = document.getElementById('fileInput').files[0];
            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                const statusMessage = document.getElementById('status');
                if (response.ok) {
                    let subscriptions = JSON.parse(localStorage.getItem('subscriptions')) || [];
                    subscriptions.push(file.name);
                    localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
                    socket.emit('subscribe', { filePath: file.name })
                } else {
                    statusMessage.textContent = 'Failed to upload files.';
                }

            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while uploading files.');
            }
        });
    </script>

</body>

</html>